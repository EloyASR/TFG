FROM node:18.13.0
LABEL org.opencontainers.image.source https://github.com/eloyasr/tfg
COPY . /app
WORKDIR /app
#Install the dependencies
RUN npm install

ARG API_URI=""
ARG CLOUDINARY_API_SECRET=""
ARG CLOUDINARY_API_KEY=""
ARG CLOUDINARY_UPLOAD_PRESET=""
ARG CLOUDINARY_UPLOAD_URL=""
ARG CLOUDINARY_DELETE_URL=""

ENV REACT_APP_API_URI=$API_URI
ENV REACT_APP_CLOUDINARY_API_SECRET=$CLOUDINARY_API_SECRET
ENV REACT_APP_CLOUDINARY_API_KEY=$CLOUDINARY_API_KEY
ENV REACT_APP_CLOUDINARY_UPLOAD_PRESET=$CLOUDINARY_UPLOAD_PRESET
ENV REACT_APP_CLOUDINARY_UPLOAD_URL=$CLOUDINARY_UPLOAD_URL
ENV REACT_APP_CLOUDINARY_DELETE_URL=$CLOUDINARY_DELETE_URL

#Create an optimized version of the webapp
RUN npm run build

#Execute npm run prod to run the server
CMD [ "npm", "run", "prod" ]
#CMD ["npm", "start"]
